<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Color Model Converter — RGB ↔ XYZ ↔ Lab</title>
  <style>
    :root {
      --bg: #0f1724;
      --card: #0b1220;
      --muted: #9aa4b2;
      --accent: #4f46e5
    }
    
    body {
      font-family: Inter, Segoe UI, Roboto, Arial;
      background: linear-gradient(180deg, #071029, #0b1220);
      color: #e6eef6;
      margin: 0;
      padding: 24px
    }
    
    .app {
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 360px 1fr;
      gap: 20px
    }
    
    .panel {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(2, 6, 23, 0.6)
    }
    
    h1 {
      margin: 0 0 8px;
      font-size: 18px
    }
    
    .swatch {
      height: 120px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700
    }
    
    label {
      display: block;
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted)
    }
    
    .row {
      display: flex;
      gap: 8px;
      align-items: center
    }
    
    input[type=range] {
      width: 100%
    }
    
    .group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px
    }
    
    .field {
      background: rgba(255, 255, 255, 0.02);
      padding: 8px;
      border-radius: 8px
    }
    
    input[type=number] {
      width: 100%;
      background: transparent;
      border: none;
      color: inherit;
      font-weight: 600
    }
    
    .models {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px
    }
    
    .chip {
      background: rgba(255, 255, 255, 0.03);
      padding: 6px 10px;
      border-radius: 20px;
      cursor: default
    }
    
    .warn {
      color: #ffcc00;
      font-size: 13px;
      margin-top: 6px
    }
    
    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 10px
    }
    
    .flex-col {
      display: flex;
      flex-direction: column
    }
    
    .right {
      padding-left: 8px
    }
    
    .hide {
      display: none
    }
    
    .foot {
      font-size: 13px;
      color: var(--muted);
      margin-top: 12px
    }
    
    .model-box {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      padding: 8px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.01)
    }
    
    .toggle-three {
      display: flex;
      gap: 6px;
      align-items: center
    }
    
    .value-small {
      font-size: 13px;
      color: var(--muted)
    }
    
    .copybtn {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.06);
      padding: 6px 10px;
      border-radius: 8px;
      cursor: pointer
    }
    
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px
    }
    
    .legend {
      font-size: 13px;
      color: var(--muted)
    }
    
    @media (max-width:900px) {
      .app {
        grid-template-columns: 1fr;
      }
    }
    
    pre.code {
      background: rgba(255, 255, 255, 0.02);
      padding: 12px;
      border-radius: 8px;
      overflow: auto;
      font-size: 13px
    }
    
    .small-muted {
      font-size: 12px;
      color: var(--muted)
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="panel">
      <div class="topbar">
        <div>
          <h1>Color Model Converter</h1>
          <div class="legend">RGB ↔ XYZ ↔ Lab (sRGB D65)</div>
        </div>
        <div class="value-small">Сохранить/поделиться:
          <button id="copyHex" class="copybtn">Копировать HEX</button>
        </div>
      </div>

      <div class="swatch" id="swatch">#000000</div>

      <label>Выбрать цвет (быстро)</label>
      <div class="row">
        <input type="color" id="colorPicker" value="#000000" style="height:36px;width:56px;border-radius:8px;border:none">
        <div style="flex:1">
          <label class="value-small">HEX</label>
          <input type="text" id="hexInput" value="#000000" style="width:100%;background:transparent;border:none;color:inherit;font-weight:700;font-size:16px">
        </div>
      </div>

      <div style="margin-top:10px">
        <label>Показывать: </label>
        <div class="models">
          <span class="chip">RGB</span>
          <span class="chip">XYZ</span>
          <span class="chip">Lab</span>
        </div>
      </div>

    </div>

    <div class="panel" id="panRight">
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px" id="modelsArea">
      </div>
      <div class="warn" id="warn"></div>
    </div>
  </div>

  <script>
let currentColor = {
  rgb: { r: 0, g: 0, b: 0 },
  xyz: { x: 0, y: 0, z: 0 },
  lab: { l: 0, a: 0, b: 0 }
};

const whitePoint = { x: 95.047, y: 100, z: 108.883 };

document.addEventListener('DOMContentLoaded', function() {
  createModelControls();
  setupEventListeners();
  updateFromRgb();
});

function createModelControls() {
  const modelsArea = document.getElementById('modelsArea');
  
  const models = [
    {
      name: 'RGB',
      channels: [
        { id: 'r', label: 'R', min: 0, max: 255, step: 1 },
        { id: 'g', label: 'G', min: 0, max: 255, step: 1 },
        { id: 'b', label: 'B', min: 0, max: 255, step: 1 }
      ]
    },
    {
      name: 'XYZ',
      channels: [
        { id: 'x', label: 'X', min: 0, max: 200, step: 0.01 },
        { id: 'y', label: 'Y', min: 0, max: 200, step: 0.01 },
        { id: 'z', label: 'Z', min: 0, max: 200, step: 0.01 }
      ]
    },
    {
      name: 'Lab',
      channels: [
        { id: 'l', label: 'L', min: 0, max: 100, step: 0.01 },
        { id: 'a', label: 'a', min: -128, max: 127, step: 0.01 },
        { id: 'b', label: 'b', min: -128, max: 127, step: 0.01 }
      ]
    }
  ];

  modelsArea.innerHTML = models.map(model => `
    <div class="model">
      <h3>${model.name}</h3>
      ${model.channels.map(channel => `
        <div class="channel">
          <label>${channel.label}</label>
          <input type="range" id="${model.name.toLowerCase()}-${channel.id}" 
                 min="${channel.min}" max="${channel.max}" step="${channel.step}" 
                 value="${channel.min}">
          <input type="number" id="${model.name.toLowerCase()}-${channel.id}-num" 
                 min="${channel.min}" max="${channel.max}" step="${channel.step}" 
                 value="${channel.min}">
        </div>
      `).join('')}
    </div>
  `).join('');
}

function setupEventListeners() {
  document.getElementById('rgb-r').addEventListener('input', function() {
    document.getElementById('rgb-r-num').value = this.value;
    updateRgbFromControls();
  });
  document.getElementById('rgb-g').addEventListener('input', function() {
    document.getElementById('rgb-g-num').value = this.value;
    updateRgbFromControls();
  });
  document.getElementById('rgb-b').addEventListener('input', function() {
    document.getElementById('rgb-b-num').value = this.value;
    updateRgbFromControls();
  });

  document.getElementById('rgb-r-num').addEventListener('input', function() {
    document.getElementById('rgb-r').value = this.value;
    updateRgbFromControls();
  });
  document.getElementById('rgb-g-num').addEventListener('input', function() {
    document.getElementById('rgb-g').value = this.value;
    updateRgbFromControls();
  });
  document.getElementById('rgb-b-num').addEventListener('input', function() {
    document.getElementById('rgb-b').value = this.value;
    updateRgbFromControls();
  });

  document.getElementById('xyz-x').addEventListener('input', function() {
    document.getElementById('xyz-x-num').value = this.value;
    updateXyzFromControls();
  });
  document.getElementById('xyz-y').addEventListener('input', function() {
    document.getElementById('xyz-y-num').value = this.value;
    updateXyzFromControls();
  });
  document.getElementById('xyz-z').addEventListener('input', function() {
    document.getElementById('xyz-z-num').value = this.value;
    updateXyzFromControls();
  });
  
  document.getElementById('xyz-x-num').addEventListener('input', function() {
    document.getElementById('xyz-x').value = this.value;
    updateXyzFromControls();
  });
  document.getElementById('xyz-y-num').addEventListener('input', function() {
    document.getElementById('xyz-y').value = this.value;
    updateXyzFromControls();
  });
  document.getElementById('xyz-z-num').addEventListener('input', function() {
    document.getElementById('xyz-z').value = this.value;
    updateXyzFromControls();
  });

  document.getElementById('lab-l').addEventListener('input', function() {
    document.getElementById('lab-l-num').value = this.value;
    updateLabFromControls();
  });
  document.getElementById('lab-a').addEventListener('input', function() {
    document.getElementById('lab-a-num').value = this.value;
    updateLabFromControls();
  });
  document.getElementById('lab-b').addEventListener('input', function() {
    document.getElementById('lab-b-num').value = this.value;
    updateLabFromControls();
  });

  document.getElementById('lab-l-num').addEventListener('input', function() {
    document.getElementById('lab-l').value = this.value;
    updateLabFromControls();
  });
  document.getElementById('lab-a-num').addEventListener('input', function() {
    document.getElementById('lab-a').value = this.value;
    updateLabFromControls();
  });
  document.getElementById('lab-b-num').addEventListener('input', function() {
    document.getElementById('lab-b').value = this.value;
    updateLabFromControls();
  });

  document.getElementById('colorPicker').addEventListener('input', function() {
    const hex = this.value;
    document.getElementById('hexInput').value = hex;
    updateFromHex(hex);
  });

  document.getElementById('hexInput').addEventListener('input', function() {
    let hex = this.value;
    if (!hex.startsWith('#')) {
      hex = '#' + hex;
      this.value = hex;
    }
    if (/^#[0-9A-F]{6}$/i.test(hex)) {
      document.getElementById('colorPicker').value = hex;
      updateFromHex(hex);
    }
  });

  const numberInputs = document.querySelectorAll('input[type="number"]');
  numberInputs.forEach(input => {
    input.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        this.blur(); 
      }
    });
  });

  document.getElementById('copyHex').addEventListener('click', function() {
    const hex = document.getElementById('hexInput').value;
    navigator.clipboard.writeText(hex).then(() => {
      const originalText = this.textContent;
      this.textContent = 'Скопировано!';
      setTimeout(() => {
        this.textContent = originalText;
      }, 2000);
    });
  });
}

function updateRgbFromControls() {
  currentColor.rgb = {
    r: Math.max(0, Math.min(255, parseInt(document.getElementById('rgb-r').value) || 0)),
    g: Math.max(0, Math.min(255, parseInt(document.getElementById('rgb-g').value) || 0)),
    b: Math.max(0, Math.min(255, parseInt(document.getElementById('rgb-b').value) || 0))
  };
  updateFromRgb();
}

function updateXyzFromControls() {
  currentColor.xyz = {
    x: Math.max(0, parseFloat(document.getElementById('xyz-x').value) || 0),
    y: Math.max(0, parseFloat(document.getElementById('xyz-y').value) || 0),
    z: Math.max(0, parseFloat(document.getElementById('xyz-z').value) || 0)
  };
  updateFromXyz();
}

function updateLabFromControls() {
  currentColor.lab = {
    l: Math.max(0, Math.min(100, parseFloat(document.getElementById('lab-l').value) || 0)),
    a: Math.max(-128, Math.min(127, parseFloat(document.getElementById('lab-a').value) || 0)),
    b: Math.max(-128, Math.min(127, parseFloat(document.getElementById('lab-b').value) || 0))
  };
  updateFromLab();
}

function updateAllDisplays() {
  updateControl('rgb', 'r', currentColor.rgb.r, 0);
  updateControl('rgb', 'g', currentColor.rgb.g, 0);
  updateControl('rgb', 'b', currentColor.rgb.b, 0);
  
  updateControl('xyz', 'x', currentColor.xyz.x, 2);
  updateControl('xyz', 'y', currentColor.xyz.y, 2);
  updateControl('xyz', 'z', currentColor.xyz.z, 2);
  
  updateControl('lab', 'l', currentColor.lab.l, 2);
  updateControl('lab', 'a', currentColor.lab.a, 2);
  updateControl('lab', 'b', currentColor.lab.b, 2);
  
  const hex = rgbToHex(currentColor.rgb.r, currentColor.rgb.g, currentColor.rgb.b);
  document.getElementById('hexInput').value = hex;
  document.getElementById('colorPicker').value = hex;
  
  const swatch = document.getElementById('swatch');
  swatch.textContent = hex;
  swatch.style.backgroundColor = hex;
  
  updateWarnings();
}

function updateWarnings() {
  const warn = document.getElementById('warn');
  const { r, g, b } = currentColor.rgb;
  
  let warnings = [];
  
  if (r < 0 || r > 255 || g < 0 || g > 255 || b < 0 || b > 255) {
    warnings.push('Цвет вне sRGB gamut!');
  }
  
  const { l, a, b: labB } = currentColor.lab;
  if (l < 0 || l > 100) {
    warnings.push('L* должен быть в диапазоне 0-100');
  }
  
  warn.textContent = warnings.join(' | ');
  warn.style.display = warnings.length > 0 ? 'block' : 'none';
}

function safeParseFloat(value, defaultValue = 0) {
  const parsed = parseFloat(value);
  return isNaN(parsed) ? defaultValue : parsed;
}

function safeParseInt(value, defaultValue = 0) {
  const parsed = parseInt(value);
  return isNaN(parsed) ? defaultValue : parsed;
}

function rgbToXyz(r, g, b) {
  const toLinear = (c) => {
    c = c / 255;
    return c <= 0.04045 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
  };

  const Rn = toLinear(r) * 100;
  const Gn = toLinear(g) * 100;
  const Bn = toLinear(b) * 100;

  const x = 0.412453 * Rn + 0.357580 * Gn + 0.180423 * Bn;
  const y = 0.212671 * Rn + 0.715160 * Gn + 0.072169 * Bn;
  const z = 0.019334 * Rn + 0.119193 * Gn + 0.950227 * Bn;

  return { x, y, z };
}

function xyzToRgb(x, y, z) {
  const Rn = 3.2406 * (x/100) - 1.5372 * (y/100) - 0.4986 * (z/100);
  const Gn = -0.9689 * (x/100) + 1.8758 * (y/100) + 0.0415 * (z/100);
  const Bn = 0.0557 * (x/100) - 0.2040 * (y/100) + 1.0570 * (z/100);

  const fromLinear = (c) => {
    c = Math.max(0, Math.min(1, c));
    return c <= 0.0031308 ? 
      Math.round(255 * 12.92 * c) : 
      Math.round(255 * (1.055 * Math.pow(c, 1/2.4) - 0.055));
  };

  return {
    r: fromLinear(Rn),
    g: fromLinear(Gn),
    b: fromLinear(Bn)
  };
}

function xyzToLab(x, y, z) {
  const f = (t) => {
    const delta = 6/29;
    return t > Math.pow(delta, 3) ? 
      Math.pow(t, 1/3) : 
      t/(3 * delta * delta) + 4/29;
  };

  const fx = f(x / whitePoint.x);
  const fy = f(y / whitePoint.y);
  const fz = f(z / whitePoint.z);

  const l = 116 * fy - 16;
  const a = 500 * (fx - fy);
  const b = 200 * (fy - fz);

  return { l, a, b };
}

function labToXyz(l, a, b) {
  const f_inv = (t) => {
    const delta = 6/29;
    return t > delta ? 
      Math.pow(t, 3) : 
      3 * delta * delta * (t - 4/29);
  };

  const fy = (l + 16) / 116;
  const fx = fy + a / 500;
  const fz = fy - b / 200;

  const x = whitePoint.x * f_inv(fx);
  const y = whitePoint.y * f_inv(fy);
  const z = whitePoint.z * f_inv(fz);

  return { x, y, z };
}

function updateFromRgb() {
  const { r, g, b } = currentColor.rgb;
  
  currentColor.xyz = rgbToXyz(r, g, b);
  
  currentColor.lab = xyzToLab(currentColor.xyz.x, currentColor.xyz.y, currentColor.xyz.z);
  
  updateAllDisplays();
}

function updateFromXyz() {
  const { x, y, z } = currentColor.xyz;
  
  currentColor.rgb = xyzToRgb(x, y, z);
  
  currentColor.lab = xyzToLab(x, y, z);
  
  updateAllDisplays();
}

function updateFromLab() {
  const { l, a, b } = currentColor.lab;
  
  currentColor.xyz = labToXyz(l, a, b);
  
  currentColor.rgb = xyzToRgb(currentColor.xyz.x, currentColor.xyz.y, currentColor.xyz.z);
  
  updateAllDisplays();
}

function updateFromHex(hex) {
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  
  currentColor.rgb = { r, g, b };
  updateFromRgb();
}

function updateRgbFromControls() {
  currentColor.rgb = {
    r: parseInt(document.getElementById('rgb-r').value),
    g: parseInt(document.getElementById('rgb-g').value),
    b: parseInt(document.getElementById('rgb-b').value)
  };
  updateFromRgb();
}

function updateXyzFromControls() {
  currentColor.xyz = {
    x: parseFloat(document.getElementById('xyz-x').value),
    y: parseFloat(document.getElementById('xyz-y').value),
    z: parseFloat(document.getElementById('xyz-z').value)
  };
  updateFromXyz();
}

function updateLabFromControls() {
  currentColor.lab = {
    l: parseFloat(document.getElementById('lab-l').value),
    a: parseFloat(document.getElementById('lab-a').value),
    b: parseFloat(document.getElementById('lab-b').value)
  };
  updateFromLab();
}

function updateAllDisplays() {
  updateControl('rgb', 'r', currentColor.rgb.r, 0);
  updateControl('rgb', 'g', currentColor.rgb.g, 0);
  updateControl('rgb', 'b', currentColor.rgb.b, 0);
  
  updateControl('xyz', 'x', currentColor.xyz.x, 2);
  updateControl('xyz', 'y', currentColor.xyz.y, 2);
  updateControl('xyz', 'z', currentColor.xyz.z, 2);
  
  updateControl('lab', 'l', currentColor.lab.l, 2);
  updateControl('lab', 'a', currentColor.lab.a, 2);
  updateControl('lab', 'b', currentColor.lab.b, 2);
  
  const hex = rgbToHex(currentColor.rgb.r, currentColor.rgb.g, currentColor.rgb.b);
  document.getElementById('hexInput').value = hex;
  document.getElementById('colorPicker').value = hex;
  
  const swatch = document.getElementById('swatch');
  swatch.textContent = hex;
  swatch.style.backgroundColor = hex;
  
  const warn = document.getElementById('warn');
  const { r, g, b } = currentColor.rgb;
  const isOutOfGamut = r < 0 || r > 255 || g < 0 || g > 255 || b < 0 || b > 255;
  warn.textContent = isOutOfGamut ? 'Цвет вне sRGB gamut!' : '';
}

function updateControl(model, channel, value, decimals) {
  const slider = document.getElementById(`${model}-${channel}`);
  const number = document.getElementById(`${model}-${channel}-num`);
  
  let formattedValue;
  if (decimals === 0) {
    formattedValue = Math.round(value);
  } else {
    formattedValue = parseFloat(value.toFixed(decimals));
  }
  
  if (parseFloat(slider.value) !== formattedValue) {
    slider.value = formattedValue;
  }
  if (parseFloat(number.value) !== formattedValue) {
    number.value = formattedValue;
  }
}

function rgbToHex(r, g, b) {
  return '#' + [r, g, b].map(x => {
    const hex = Math.max(0, Math.min(255, x)).toString(16);
    return hex.length === 1 ? '0' + hex : hex;
  }).join('');
}
  </script>

</body>


</html>
